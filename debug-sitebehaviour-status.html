// Quick Debug Commands for SiteBehaviour - Copy/Paste into Browser Console

console.log('üîç SITEBEHAVIOUR QUICK DEBUG COMMANDS');
console.log('====================================');

// Command 1: Check overall status
console.log('\n1Ô∏è‚É£ Checking Overall Status...');
try {
    if (typeof checkSiteBehaviourConnection === 'function') {
        checkSiteBehaviourConnection();
    } else {
        console.log('‚ùå checkSiteBehaviourConnection function not available');
        
        // Manual check
        const script = document.querySelector('#site-behaviour-script-v2');
        const secret = window.sitebehaviourTrackingSecret;
        const expectedSecret = '507f5743-d0f0-49db-a5f0-0d702b989128';
        
        console.log('Manual Status Check:');
        console.log('Script Element:', script ? '‚úÖ FOUND' : '‚ùå MISSING');
        console.log('Secret Variable:', secret ? '‚úÖ SET' : '‚ùå MISSING');
        console.log('Secret Correct:', secret === expectedSecret ? '‚úÖ VALID' : '‚ùå INVALID');
        
        if (script) {
            console.log('Script Source:', script.src);
        }
        if (secret) {
            console.log('Secret Value:', secret.substring(0, 8) + '...');
        }
    }
} catch (error) {
    console.error('Error in status check:', error);
}

// Command 2: Run transmission test
console.log('\n2Ô∏è‚É£ Running Transmission Test...');
try {
    if (typeof testSiteBehaviourConnection === 'function') {
        testSiteBehaviourConnection();
    } else {
        console.log('‚ùå testSiteBehaviourConnection function not available');
        
        // Manual transmission test
        try {
            document.dispatchEvent(new CustomEvent('sitebehaviour-test', {
                detail: {
                    test: 'manual_debug',
                    timestamp: Date.now(),
                    source: 'debug_commands'
                }
            }));
            console.log('‚úÖ Manual test event dispatched');
        } catch (testError) {
            console.error('‚ùå Failed to dispatch test event:', testError);
        }
    }
} catch (error) {
    console.error('Error in transmission test:', error);
}

// Command 3: View script element
console.log('\n3Ô∏è‚É£ Viewing Script Element...');
try {
    const script = document.querySelector('#site-behaviour-script-v2');
    
    if (script) {
        console.log('‚úÖ Script Element Details:');
        console.log(script);
        console.log('Properties:');
        console.log('  - ID:', script.id);
        console.log('  - Source:', script.src);
        console.log('  - Defer:', script.defer);
        console.log('  - Parent:', script.parentNode.tagName);
        console.log('  - Loaded:', script.readyState || 'unknown');
    } else {
        console.log('‚ùå Script element not found');
        console.log('Checking all scripts with "sitebehaviour" in src...');
        
        const allScripts = document.querySelectorAll('script[src*="sitebehaviour"]');
        if (allScripts.length > 0) {
            console.log('Found related scripts:');
            allScripts.forEach((s, i) => {
                console.log(`  ${i + 1}. ${s.src}`);
            });
        } else {
            console.log('No SiteBehaviour scripts found in DOM');
        }
    }
} catch (error) {
    console.error('Error viewing script element:', error);
}

// Command 4: Check secret
console.log('\n4Ô∏è‚É£ Checking Secret Variable...');
try {
    const secret = window.sitebehaviourTrackingSecret;
    const expectedSecret = '507f5743-d0f0-49db-a5f0-0d702b989128';
    
    if (secret) {
        console.log('‚úÖ Secret Variable Details:');
        console.log('  - Type:', typeof secret);
        console.log('  - Length:', secret.length, 'characters');
        console.log('  - Preview:', secret.substring(0, 8) + '...');
        console.log('  - Full Value:', secret);
        console.log('  - Expected:', expectedSecret);
        console.log('  - Match:', secret === expectedSecret ? '‚úÖ YES' : '‚ùå NO');
        
        if (secret !== expectedSecret) {
            console.log('‚ö†Ô∏è SECRET MISMATCH DETECTED');
            console.log('This could prevent tracking from working properly');
        }
    } else {
        console.log('‚ùå Secret variable not found');
        console.log('window.sitebehaviourTrackingSecret is:', secret);
        
        // Check if it might be set differently
        const allKeys = Object.keys(window).filter(key => 
            key.toLowerCase().includes('sitebehaviour') || 
            key.toLowerCase().includes('tracking')
        );
        
        if (allKeys.length > 0) {
            console.log('Related window variables found:');
            allKeys.forEach(key => {
                console.log(`  - ${key}:`, window[key]);
            });
        }
    }
} catch (error) {
    console.error('Error checking secret:', error);
}

// Summary
console.log('\nüìä QUICK DEBUG SUMMARY');
console.log('=====================');

const script = document.querySelector('#site-behaviour-script-v2');
const secret = window.sitebehaviourTrackingSecret;
const expectedSecret = '507f5743-d0f0-49db-a5f0-0d702b989128';

const checks = {
    scriptLoaded: !!script,
    secretSet: !!secret,
    secretCorrect: secret === expectedSecret,
    functionsAvailable: typeof checkSiteBehaviourConnection === 'function'
};

console.log('Status Overview:');
Object.entries(checks).forEach(([check, passed]) => {
    console.log(`  ${passed ? '‚úÖ' : '‚ùå'} ${check}: ${passed ? 'PASS' : 'FAIL'}`);
});

const allPassed = Object.values(checks).every(Boolean);
console.log('\nüéØ Overall Status:', allPassed ? '‚úÖ ALL SYSTEMS GO' : '‚ö†Ô∏è ISSUES DETECTED');

if (!allPassed) {
    console.log('\nüîß TROUBLESHOOTING STEPS:');
    if (!checks.scriptLoaded) {
        console.log('1. Script not loaded - check network connection');
        console.log('2. Verify CDN is accessible: https://sitebehaviour-cdn.fra1.cdn.digitaloceanspaces.com/');
    }
    if (!checks.secretSet) {
        console.log('3. Secret not set - check tracking code implementation');
    }
    if (checks.secretSet && !checks.secretCorrect) {
        console.log('4. Secret mismatch - verify tracking key is correct');
    }
    if (!checks.functionsAvailable) {
        console.log('5. Debug functions not available - check script loading order');
    }
}

console.log('\nüí° To run these commands again, refresh page and paste this script');